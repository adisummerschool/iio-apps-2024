#include <stdio.h>
#include <stdlib.h>
#include <iio.h>
#include <string.h>
#include <unistd.h>
#define URI "ip:10.76.84.103"

const int MAX_ADC = 4095;
const double VOLTS_PER_LSB = 2.4 / MAX_ADC;

int main(){
    struct iio_context *ctx = iio_create_context_from_uri(URI);
    if (!ctx) {
        printf("\n no context\n"); 
        return -1;
    }
    struct iio_device *dev = iio_context_find_device(ctx, "iio:device0");
    if (!dev) {
        printf("\n no device \n");
        return -1;
    }
    iio_device_attr_write(dev, "en", "1");
  
    struct iio_channel *ch0 = iio_device_find_channel(dev, "voltage0", false);
    struct iio_channel *ch1 = iio_device_find_channel(dev, "voltage1", false);
    struct iio_channel *ch2 = iio_device_find_channel(dev, "voltage2", false);
    struct iio_channel *ch3 = iio_device_find_channel(dev, "voltage3", false);
    struct iio_channel *ch4 = iio_device_find_channel(dev, "voltage4", false);
    struct iio_channel *ch5 = iio_device_find_channel(dev, "voltage5", false);
    if (!ch0 || !ch1 || !ch2 || !ch3 || !ch4 || !ch5) {
        perror("Channel not found");
        return -1;
    }
    
    char chn0_str[100]; 
    iio_channel_attr_read(ch0, "raw", chn0_str, sizeof(chn0_str));
    int chn0_raw = atoi(chn0_str);

    double chn0_voltage = chn0_raw * VOLTS_PER_LSB;
    printf("VOLTAGE IS %f [V]\n", chn0_voltage)

    
    return 0;
}